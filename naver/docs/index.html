<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>실시간 트렌드 대시보드</title>
    <style>
      :root {
        --card: #ffffff;
        --line: #dbe3ee;
        --text: #1f2937;
        --muted: #64748b;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
        color: var(--text);
        background: radial-gradient(circle at 10% 10%, #eef8ff 0%, #f4f7fb 45%, #edf5ff 100%);
      }
      .wrap { max-width: 1080px; margin: 0 auto; padding: 24px 16px 40px; }
      h1 { margin: 0 0 8px; font-size: 30px; }
      .sub { margin: 0 0 18px; color: var(--muted); }
      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 16px;
      }
      .topbar { display: flex; justify-content: space-between; gap: 8px; flex-wrap: wrap; }
      .cols { display: grid; grid-template-columns: 1fr; gap: 14px; margin-top: 14px; }
      h2 { margin: 0 0 10px; font-size: 18px; }
      ol { margin: 0; padding-left: 22px; }
      li { margin: 7px 0; }
      a { color: #174ea6; text-decoration: none; }
      a:hover { text-decoration: underline; }
      .warn {
        margin-top: 8px;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #fde3b2;
        background: #fff7e6;
        color: #8a5b00;
        font-size: 13px;
      }
      .small { color: var(--muted); font-size: 13px; }
      @media (min-width: 840px) {
        .cols { grid-template-columns: 1fr 1fr; }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>실시간 트렌드 대시보드</h1>
      <p class="sub">GitHub Actions가 주기적으로 `data.json`을 갱신합니다.</p>

      <section class="card topbar">
        <div class="small">마지막 업데이트: <span id="updatedAt">-</span></div>
        <a href="./data.json" target="_blank" rel="noopener noreferrer" class="small">원본 JSON 보기</a>
      </section>

      <div id="warnings"></div>

      <div class="cols">
        <section class="card">
          <h2>실시간 검색어 TOP 10</h2>
          <ol id="keywords"></ol>
        </section>

        <section class="card">
          <h2>실시간 인기기사 TOP 10</h2>
          <ol id="articles"></ol>
        </section>
      </div>
    </div>

    <script>
      const keywordsEl = document.getElementById('keywords');
      const articlesEl = document.getElementById('articles');
      const updatedAtEl = document.getElementById('updatedAt');
      const warningsEl = document.getElementById('warnings');

      function renderKeywords(items) {
        keywordsEl.innerHTML = '';
        if (!items || items.length === 0) {
          keywordsEl.innerHTML = '<li>데이터가 없습니다.</li>';
          return;
        }
        items.slice(0, 10).forEach((keyword) => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = `https://search.naver.com/search.naver?query=${encodeURIComponent(keyword)}`;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = keyword;
          li.appendChild(a);
          keywordsEl.appendChild(li);
        });
      }

      function renderArticles(items) {
        articlesEl.innerHTML = '';
        if (!items || items.length === 0) {
          articlesEl.innerHTML = '<li>데이터가 없습니다.</li>';
          return;
        }
        items.slice(0, 10).forEach((item) => {
          const li = document.createElement('li');
          const text = document.createElement('span');
          text.textContent = `${item.title} `;
          const link = document.createElement('a');
          link.href = item.href;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          link.textContent = '[기사보기]';
          li.appendChild(text);
          li.appendChild(link);
          articlesEl.appendChild(li);
        });
      }

      function renderWarnings(warnings) {
        warningsEl.innerHTML = '';
        if (!warnings || warnings.length === 0) return;
        warnings.forEach((w) => {
          const div = document.createElement('div');
          div.className = 'warn';
          div.textContent = w;
          warningsEl.appendChild(div);
        });
      }

      async function load() {
        try {
          const res = await fetch('./data.json?ts=' + Date.now(), { cache: 'no-store' });
          const data = await res.json();
          renderKeywords(data.keywords || []);
          renderArticles(data.articles || []);
          renderWarnings(data.warnings || []);
          updatedAtEl.textContent = data.updatedAt ? new Date(data.updatedAt).toLocaleString('ko-KR') : '-';
        } catch (e) {
          warningsEl.innerHTML = '<div class="warn">data.json을 불러오지 못했습니다.</div>';
        }
      }

      load();
    </script>
  </body>
</html>
